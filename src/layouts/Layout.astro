---
// src/layouts/Layout.astro
import "../styles/global.css";
import NavBar from "../components/NavBar.astro";
import Footer from "../components/Footer.astro";

interface Props {
  title?: string;
  description?: string;
  canonical?: string;
  showAnimatedBackground?: boolean;
}

const {
  title = "Dimas - Portfolio",
  description = "Data enthusiast portfolio",
  canonical,
  showAnimatedBackground = true,
} = Astro.props;

const currentPath = Astro.url.pathname.replace(/\/$/, "") || "/";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <title>{title}</title>
    <meta name="description" content={description} />

    {canonical && <link rel="canonical" href={canonical} />}

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
  </head>
  <body class="font-display text-black-alt bg-black-alt m-0">
    <div
      id="container"
      class="fixed inset-0 m-2 sm:m-4 rounded-2xl overflow-hidden bg-ghost-white"
    >
      {
        showAnimatedBackground && (
          <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
            <div class="absolute top-0 -left-40 w-96 h-96 bg-poppy/10 rounded-full blur-3xl animate-blob" />
            <div class="absolute top-0 -right-40 w-96 h-96 bg-blue-crayola/10 rounded-full blur-3xl animate-blob animation-delay-2000" />
            <div class="absolute -bottom-40 left-1/2 -translate-x-1/2 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-blob animation-delay-4000" />
          </div>
        )
      }

      <div
        id="scroll-container"
        class="relative z-10 flex flex-col h-full overflow-y-auto no-scrollbar"
      >
        <NavBar currentPath={currentPath} />
        <main class="flex-1 pb-16">
          <slot />
        </main>
        <Footer />

        <!-- Scroll to Top Button -->
        <button
          id="scroll-to-top"
          class="fixed bottom-6 right-6 sm:bottom-8 sm:right-8 w-12 h-12 sm:w-14 sm:h-14 bg-gradient-to-r from-blue-crayola to-blue-600 text-white rounded-full shadow-xl hover:shadow-2xl hover:shadow-blue-crayola/40 hover:scale-110 active:scale-95 transition-all duration-300 flex items-center justify-center opacity-0 pointer-events-none z-50 cursor-pointer"
          aria-label="Scroll to top"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6 sm:h-7 sm:w-7"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z"
              clip-rule="evenodd"></path>
          </svg>
        </button>
      </div>
    </div>
  </body>
</html>

<style>
  html,
  body {
    margin: 0;
    width: 100%;
    height: 100%;
  }

  .no-scrollbar {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }

  @keyframes blob {
    0%,
    100% {
      transform: translate(0, 0) scale(1);
    }
    33% {
      transform: translate(30px, -50px) scale(1.1);
    }
    66% {
      transform: translate(-20px, 20px) scale(0.9);
    }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-blob {
    animation: blob 7s infinite;
  }
  .animation-delay-2000 {
    animation-delay: 2s;
  }
  .animation-delay-4000 {
    animation-delay: 4s;
  }

  /* Scroll to top button animations */
  #scroll-to-top.show {
    opacity: 1;
    pointer-events: auto;
    animation: fadeInUp 0.3s ease-out;
  }

  #scroll-to-top:hover {
    background: linear-gradient(to right, #1e40af, #1e3a8a);
  }

  /* Mobile touch feedback */
  @media (hover: none) and (pointer: coarse) {
    #scroll-to-top:active {
      background: linear-gradient(to right, #1e3a8a, #1e40af);
    }
  }
</style>

<script>
  // Scroll to top functionality
  const scrollContainer = document.getElementById("scroll-container");
  const scrollToTopBtn = document.getElementById("scroll-to-top");

  if (scrollContainer && scrollToTopBtn) {
    // Show/hide button based on scroll position
    scrollContainer.addEventListener("scroll", () => {
      if (scrollContainer.scrollTop > 300) {
        scrollToTopBtn.classList.add("show");
      } else {
        scrollToTopBtn.classList.remove("show");
      }
    });

    // Smooth scroll to top when button is clicked
    scrollToTopBtn.addEventListener("click", () => {
      scrollContainer.scrollTo({
        top: 0,
        behavior: "smooth",
      });
    });
  }
</script>
