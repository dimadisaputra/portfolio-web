---
// src/pages/projects.astro
import Layout from "../layouts/Layout.astro";
import ProjectCard from "../components/ProjectCard.astro";
import { getCollection } from "astro:content";

const allProjects = await getCollection("projects", ({ data }) => {
  return data.draft !== true;
});

const sortedProjects = allProjects.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Ambil semua kategori unik dari proyek dan tambahkan "All" di depan
const categories = ["All", ...new Set(allProjects.map((p) => p.data.category))];

const title = "All Projects - Dimas Portfolio";
const description = "Browse all data projects by Dimas Adi Saputra";
---

<Layout title={title} description={description}>
  <div class="mt-24 mb-32 sm:mt-32 w-full max-w-7xl mx-auto px-6">
    <!-- Header Section -->
    <div class="text-center mb-16 animate-fade-in-up">
      <div
        class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-blue-crayola/10 to-poppy/10 border border-blue-crayola/20 backdrop-blur-sm mb-6"
      >
        <span class="text-sm font-medium text-gray-700">Portfolio Showcase</span
        >
      </div>

      <h1
        class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-black-alt mb-4 leading-tight"
      >
        All of my <span
          class="text-transparent bg-clip-text bg-gradient-to-r from-blue-crayola to-blue-600"
          >projects</span
        > is here!
      </h1>

      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Explore my collection of projects across different categories
      </p>
    </div>

    <!-- Filter Buttons -->
    <div
      class="mb-12 flex flex-wrap justify-center gap-3 animate-fade-in-up animation-delay-200"
      id="filter-container"
    >
      {
        categories.map((category, index) => (
          <button
            data-filter-btn
            data-category={category}
            class:list={[
              "relative overflow-hidden font-semibold px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg will-change-transform",
              index === 0
                ? "bg-gradient-to-r from-blue-crayola to-blue-600 text-white shadow-md shadow-blue-crayola/30"
                : "bg-white text-gray-700 border border-gray-200 hover:border-blue-crayola/30 hover:shadow-md",
            ]}
          >
            <span class="relative z-10">{category}</span>
            {index === 0 && (
              <div class="absolute inset-0 bg-gradient-to-r from-blue-600 to-blue-crayola opacity-0 group-hover:opacity-100 transition-opacity duration-300" />
            )}
          </button>
        ))
      }
    </div>

    <!-- Project Grid -->
    {
      sortedProjects.length > 0 ? (
        <div
          id="project-grid"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8"
        >
          {sortedProjects.map((project, index) => (
            <div
              data-project-card
              data-category={project.data.category}
              style={`animation: fadeInUp 0.6s ease-out ${index * 0.1}s both;`}
            >
              <ProjectCard
                title={project.data.title}
                description={project.data.description}
                image={project.data.image}
                imageAlt={project.data.imageAlt}
                slug={project.slug}
                category={project.data.category}
              />
            </div>
          ))}
        </div>
      ) : null
    }

    <!-- Not Found Message -->
    <div
      id="not-found-message"
      class="text-center py-24"
      style="display: none;"
    >
      <div
        class="inline-block p-8 rounded-3xl bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200"
      >
        <div class="text-6xl mb-4">üîç</div>
        <p class="text-2xl font-bold text-gray-700 mb-2">No projects found</p>
        <p class="text-gray-500">Try selecting a different category</p>
      </div>
    </div>
  </div>
</Layout>

<style>
  @keyframes blob {
    0%,
    100% {
      transform: translate(0, 0) scale(1);
    }
    33% {
      transform: translate(30px, -50px) scale(1.1);
    }
    66% {
      transform: translate(-20px, 20px) scale(0.9);
    }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-blob {
    animation: blob 7s infinite;
  }

  .animation-delay-2000 {
    animation-delay: 2s;
  }

  .animation-delay-4000 {
    animation-delay: 4s;
  }

  .animate-fade-in-up {
    animation: fadeInUp 0.8s ease-out;
  }

  .animation-delay-200 {
    animation-delay: 0.2s;
    animation-fill-mode: both;
  }
</style>

<script>
  // Ambil semua elemen yang diperlukan
  const filterButtons =
    document.querySelectorAll<HTMLButtonElement>("[data-filter-btn]");
  const projectCards = document.querySelectorAll<HTMLDivElement>(
    "[data-project-card]"
  );
  const notFoundMessage = document.getElementById(
    "not-found-message"
  ) as HTMLDivElement;
  const projectGrid = document.getElementById("project-grid");

  // Tambahkan event listener ke setiap tombol filter
  filterButtons.forEach((button) => {
    button.addEventListener("click", () => {
      const selectedCategory = button.dataset.category;
      let visibleProjects = 0;

      // Update style tombol yang aktif
      filterButtons.forEach((btn) => {
        // Reset semua tombol ke style default
        btn.className =
          "relative overflow-hidden font-semibold px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg will-change-transform bg-white text-gray-700 border border-gray-200 hover:border-blue-crayola/30 hover:shadow-md";
      });

      // Set tombol aktif
      button.className =
        "relative overflow-hidden font-semibold px-6 py-3 rounded-xl transition-all duration-300 hover:scale-105 hover:shadow-lg will-change-transform bg-gradient-to-r from-blue-crayola to-blue-600 text-white shadow-md shadow-blue-crayola/30";

      // Filter kartu proyek berdasarkan kategori
      projectCards.forEach((card) => {
        const projectCategory = card.dataset.category;
        const shouldShow =
          selectedCategory === "All" || projectCategory === selectedCategory;

        card.style.display = shouldShow ? "block" : "none";

        if (shouldShow) {
          visibleProjects++;
        }
      });

      // Tampilkan pesan jika tidak ada proyek yang cocok
      if (projectGrid) {
        const hasProjects = projectCards.length > 0;
        notFoundMessage.style.display =
          visibleProjects === 0 && hasProjects ? "block" : "none";
      }
    });
  });

  // Pengecekan awal jika tidak ada proyek sama sekali
  if (projectCards.length === 0) {
    if (projectGrid) projectGrid.style.display = "none";
    notFoundMessage.style.display = "block";
    notFoundMessage.innerHTML = `
      <div class="inline-block p-8 rounded-3xl bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200">
        <div class="text-6xl mb-4">üì≠</div>
        <p class="text-2xl font-bold text-gray-700 mb-2">No projects available yet</p>
        <p class="text-gray-500">Please check back later</p>
      </div>
    `;
  }
</script>
