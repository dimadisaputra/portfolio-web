---
// src/components/ProgressiveWordReveal.astro
interface Props {
  text: string;
  class?: string;
  delayStep?: number;
}

const { text, class: customClass = "", delayStep = 5 } = Astro.props;

const words = text
  .split(" ")
  .map(
    (word, index) =>
      `<span class="word" style="--delay:${index * delayStep}ms">${word}</span>`
  )
  .join(" ");
---

<p
  class={`progressive-reveal-container flex flex-wrap gap-x-2 gap-y-1 ${customClass}`}
  set:html={words}
/>

<style is:global>
  @reference "../styles/global.css";
  .progressive-reveal-container .word {
    --delay: 0ms; /* Default delay */
    opacity: 0.15;
    transform: translateY(10px);
    transition:
      opacity 0.4s ease-out,
      transform 0.4s ease-out;
    transition-delay: var(--delay);
  }
  .progressive-reveal-container .word.is-revealed {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add("is-revealed");
            observer.unobserve(entry.target);
          }
        });
      },
      {
        rootMargin: "0px 0px -15% 0px",
      }
    );

    const wordsToObserve = document.querySelectorAll(
      ".progressive-reveal-container .word"
    );
    wordsToObserve.forEach((word) => {
      observer.observe(word);
    });
  });
</script>
